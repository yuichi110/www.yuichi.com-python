<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="Sample Description" name="description"/>
  <link href="./assets/favicon.ico" rel="icon"/>
  <title>
   Python入門
  </title>
  <link href="./assets/css/bootstrap.css" rel="stylesheet">
   <link href="./assets/css/codehilite_colorful.css" rel="stylesheet"/>
  </link>
 </head>
 <body>
  <!-- GENERATED HTML START -->
  <h2>
   コンストラクタ
  </h2>
  <h3>
   概要
  </h3>
  <p>
   あとで書く
  </p>
  <h3>
   コンストラクタの定義
  </h3>
  <h4>
   インスタンス作成時に呼び出される特殊なメソッド
  </h4>
  <p>
   クラスにデータを持たせる際に以下のように
   <code>
    def __init__
   </code>
   内に定義をするとお話しました。
  </p>
  <div class="codehilite">
   <pre><span></span><span class="k">class</span> <span class="nc">UserInfo</span><span class="p">:</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">''</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">birth</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="s1">''</span>
</pre>
  </div>
  <p>
   実はこの
   <code>
    __init__
   </code>
   は、「インスタンスが作成されるタイミングで呼び出される特殊なメソッド」です。
一般的にそのような処理をするメソッドは「コンストラクタ」と呼ばれており、
形は違えど Java や C++ といったオブジェクト指向の言語ではなんらかの形で実装されていることが多いです。
コンストラクトは「構築する」という意味なので、それをやるコンストラクタという名前になっています。
  </p>
  <p>
   試しに
   <strong>
    init
   </strong>
   内にprint分を加えてインスタンスを作成し、コンストラクタの挙動を見てみます。
  </p>
  <div class="codehilite">
   <pre><span></span><span class="k">class</span> <span class="nc">UserInfo</span><span class="p">:</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'initialize instance'</span><span class="p">)</span> <span class="c1"># HERE</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">''</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">birth</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="s1">''</span>

<span class="n">taro</span> <span class="o">=</span> <span class="n">UserInfo</span><span class="p">()</span>
<span class="c1"># initialize instance</span>
</pre>
  </div>
  <p>
   このプログラムを実行すると、インスタンスを作成した際に
   <code>
    __init__
   </code>
   内にあるprint文が呼び出されることがわかります。
  </p>
  <h4>
   コンストラクタの引数
  </h4>
  <p>
   さて、このコンストラクタなのですが見てわかるように文法としてはメソッドの宣言そのもので、
名前が
   <code>
    __init__
   </code>
   ということ以外は特別なことはありません。
そのため、通常のメソッドと同じようにコンストラクタも引数を複数与えることができます。
このコンストラクタの引数はクラスをインスタンス化する際に利用されます。
実際にコンストラクタの引数の利用例を見たほうがわかりやすいと思うので、上記サンプルを改良して
   <code>
    __init__
   </code>
   に引数を与えてみます。
  </p>
  <div class="codehilite">
   <pre><span></span><span class="k">class</span> <span class="nc">UserInfo</span><span class="p">:</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">birth</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'initialize instance'</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">birth</span> <span class="o">=</span> <span class="n">birth</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
</pre>
  </div>
  <p>
   インスタンス作成時にコンストラクタで定義した引数に対応した値を渡します。
例のごとく
   <code>
    self
   </code>
   に相当するものは飛ばしています。
  </p>
  <div class="codehilite">
   <pre><span></span><span class="n">taro</span> <span class="o">=</span> <span class="n">UserInfo</span><span class="p">(</span><span class="s1">'taro'</span><span class="p">,</span> <span class="mi">1980</span><span class="p">,</span> <span class="s1">'tokyo'</span><span class="p">)</span>
<span class="c1"># initialize instance</span>

<span class="k">print</span><span class="p">(</span><span class="n">taro</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="c1"># taro</span>
<span class="k">print</span><span class="p">(</span><span class="n">taro</span><span class="o">.</span><span class="n">birth</span><span class="p">)</span>
<span class="c1"># 1980</span>
<span class="k">print</span><span class="p">(</span><span class="n">taro</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
<span class="c1"># tokyo</span>
</pre>
  </div>
  <p>
   コンストラクタで定義した引数に対応した形で、インスタンス化が行われていることがわかります。
具体的には宣言である
   <code>
    def __init__(self, name, birth, address)
   </code>
   と、
呼び出しである
   <code>
    UserInfo('taro', 1986, 'tokyo')
   </code>
   の対応が取れています。
そしてコンストラクタ内では、与えられた引数をインスタンスのデータの初期化に利用しています。
  </p>
  <h4>
   コンストラクタを使うメリット
  </h4>
  <p>
   コンストラクタの引数を使うと「インスタンスの初期化を実施する」という保証を与えることができます。
今までのようにコンストラクタを使わずに個別にデータを初期化する実装にすると特定のデータの初期化を忘れる可能性が考えられます。
一方、コンストラクタの引数を通して初期化を行うのであれば、
初期化を忘れるとそれは「プログラムのエラー」という形でその場ですぐにわかります。
そのため、きちんとテストをしていれば初期化を忘れることはありません。
インスタンス生成直後にインスタンス変数になにか値を設定することが必須であれば、それは必ずコンストラクタで設定されるべきです。
なお、コンストラクタ内の「
   <code>
    self.xxx = xxx
   </code>
   」の前者はインスタンスが持つインスタンス変数であり、
後者はコンストラクタの引数(メソッド内のローカル変数)なので別物です。
両者に別の名前を付けても構いませんが、同名にすると対応が分かりやすいためこのようにすることが多いです。
  </p>
  <p>
   コンストラクタの役割はインスタンス変数の設定以外にもあります。
インスタンスを作るにあたり、なにか複雑な処理が必要であればそれはコンストラクタ内で実現されます。
たとえば設定ファイルを管理するクラスを作るのであれば、設定ファイルの存在の確認や既存の設定のロード処理などもコンストラクタの役割になるかもしれません。
ちなみに、コンストラクタは省略可能です。
インスタンス変数が存在しなかったり、上記のような初期化処理が不要だったりする場合は宣言しないでかまいません。
その場合はインスタンスが作成された際に何もしません。
  </p>
  <p>
   なお、Pythonの
   <code>
    __init__
   </code>
   は、厳密には一般的なコンストラクタとは異なる別物という見解があります。
ただ、表面上は同様の動きをしてくれるため上級者以外は気にする必要はありません。
もう少しプログラマとしてのレベルがあがって、いろいろな言語を使えるようになってから調べてみると、面白いかもしれません。
  </p>
  <!-- GENERATED HTML END -->
 </body>
</html>
