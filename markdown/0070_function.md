# 関数

{{ TOC }}

## 概要

Pythonに限らず、多くのプログラミング言語には「関数」という概念があります。
関数は呼び出し元から「引数」として値を受けとり、
内部で「処理」をして、結果を「返り値」として返します。
引数と返り値は必須ではなく、どちらかもしくは両方がないこともあります。

関数は以下の役割を持っています

* Pythonが提供する機能を呼び出す
* プログラムを分かりやすくする
* プログラムの重複を減らす

Pythonが提供する関数を使うことでキーボードやファイルからの入力、
ディスプレイへの出力といったプログラマーが作れない処理を実現できます。

複雑な処理をPythonが提供する関数で簡単に実現できたり、
自分でその関数を作ることで複雑なコードを外に追いやることでプログラムの見通しがよくなります。
また、似たような処理をコピーペーストではなく関数を使って実現できるため、
プログラムの重複が減ります。

## Pythonが提供する組み込み関数

関数はプログラマが自分で作るものと、プログラミング言語の環境(Python)が提供するものがあり、
後者を特に「*組み込み関数*」と呼びます。

たとえば出力をコンソールにするprint文も組み込み関数です。
この関数に値を与えると、それがコンソールに表示されます。

```python
print('Hello Python')
```

```text
Hello Python
```

この関数の「()」にいれる値を「*引数*」と呼んでいます。
関数の目線で「引き込む値」で、関数を使う側が関数に渡す値です。
上記の例では「'Hello Python'」という文字列が引数であり、
これがprint関数を使う側からprint関数に渡されています。

関数はそれぞれ役割を持っていて、print関数は引数をコンソールに表示することが役割です。

<<図>>

別の関数len()はリストの長さを確認するための関数です。
この関数は引数としてリストを受け取ると、リストの長さを求めるという処理をします。
ただ、先ほどのprint関数と異なり、この関数はリストの長さをプログラムの呼び出し側に「返す」という動きをします。
この返す値のことを「返り値」と呼びます。

```python
a = ['h', 'e', 'l', 'l', 'o']
b = len(a)
print(b)
```

```text
5
```

先ほどのprint関数は引数を処理のなかで画面出力することが役割でしたので、
特に値を呼び出し元に返す必要がありません。
そのため返り値がありませんでした。

一方、関数lenは処理の役割がリストの長さを求めるということなので、
求めた値を呼び出し元に返さないと呼び出した意味がありません。
そのため、呼び出し元に返り値を返します。

<<図>>

関数は突き詰めると「呼び出し元が引数で値を関数に渡す」「関数の処理のなかで引数を使ってなにかをする」
「関数が返り値として処理した結果を呼び出し側に返す」という3つの流れに集約されます。

## 関数の定義と利用

組み込み関数を使うだけでなく、関数を自分で作って使うこともできます。
関数の定義もif文やfor文と同じように、「*def文*」を使って宣言し、コードブロックで処理を書きます。

リスト長を求めるlen()関数と同じことをする「mylen()」関数を定義します。

<<図>>

def文に続けて自分がつけたい関数名を書き、それに続けて()に囲まれた引数を書きます。
関数名や引数名は変数と同じように自分の好きな名前をつけられます。
ただ、変数と同じく小文字のアルファベットとアンダーバーと数字を使うのが一般的です。

コードブロック内にその処理を書き、ここではfor文を使って要素を全てループして数を数えています。
求めた値を呼び出し側に返すには「*return文*」を使います。

return文は関数を打ち切るキーワードで、return文以降のコードは実行されません。
return文の後ろに何も書かなければ返り値はなにもなく、後ろに値を書けばそれが返り値となります。
return文がない、もしくはif文の関係で実行されなかったといった場合は、
関数のコードブロックの最後まで実行されて返り値なしとなります。

自分が定義した関数を使う方法は組み込み関数と全く同じです。

```python
```

```text
```




```python
def my_abs(x):
  if(x >= 0):
    return x
  else:
  	return x * -1

print(my_abs(5))
# 5

print(my_abs(-3.3))
# 3.3
```

関数の入力と出力はそれぞれなくてもかまわず、入力がない場合は関数の宣言の引数(入力の宣言)をなくし、
出力が不要な場合はreturn文(出力の宣言)をなくします。

具体的には以下のように関数を定義します。

```python
# 引数がない関数
def my_func1():
  return 0

# 返り値がない関数
def my_func2(x):
  x = x * -1
```

関数をどう呼び出すかについては今までさんざん利用したのでなんとなくわかると思いますが、
宣言した引数に対応する箇所に入力値を入れることで呼び出します。
ひとつ目の変数は引数がないので、呼び出し時に()に何も入れていないものの、
後者は引数をとるので()に値を与えています。
返り値については return されたものが返ってきて、
なにも return されていない場合は None が返ってきます。
この None については後述しますがようするに「なにもない」ということです。

```python
print(my_func1())  
# 0

print(my_func2(5))
# None
```

ほかに知っておくべきこととしては以下のものがあります。
*	引数は複数指定できる
*	return文は一度しか実行されない

これも具体例を示しましょう。

```python
def my_func3(x, y):
  print('A')
  if(x > y):
    return x
  print('B')
  return y

print(my_func3(5,1))
# A
# 5

print(my_func3(2,4))
# A
# B
# 4
```

上記関数では入力値を2つとっています。
コンマで区切られた引数の数のぶんだけ入力を受け付けるという簡単なルールです。
そして、内部では2つのreturn文が確認できます。
注目して欲しいのはx > yの条件を満たす場合はprint('B')が実行されていないということです。
return文はいくつあっても構わないのですが、returnされたあとの関数の処理は一切無視されます。

ほかには「デフォルト引数」や「可変長引数」といった関数の書き方もありますが、
高度なトピックとなるため本書の最後の章にてアドバンスドトピックとして扱います。


## 関数の必要性

プログラムは必ず、キーボード入力やファイルの読み込みといった「外からの情報の入力」と、
ディスプレイやスピーカー出力といった「外への情報の出力」を必要としています。
入出力のないプログラムも作れますが、動かしても「プログラムの外の世界」に何も影響がないので、
CPUとメモリを無駄に消費するという目的以外には使えません。
変数や条件分岐といった制御はあくまでもデータを処理するための手段でしかなく、
プログラムの外とやりとりするためには関数が必須です。
先に説明した画面への文字出力を行うprint関数もその一例です。

そして「関数を使わなくても書けるコード」も、うまく関数を使うことで「分かりやすいコード」になります。
例をあげて説明してみます。
絶対値を得ようと思った場合、以下のようにif文で条件分岐させることで実現が可能です。

```python
x = -5
if(x<0):
  x = x * -1
print(x)
# 5
```

2、3行目を見てもらうとわかりますが、「もしxが0より小さければ、xに-1をかける」という処理をしており、
絶対値を得ているということが読み取れます。
同じ処理を、絶対値を得る関数abs()を使って書くと、以下のようになります。

```python
x = abs(-5)
print(x)
# 5
```

前者と後者は同じことを実現していますが、どちらのほうがわかりやすいと思いますか。
圧倒的に後者です。

関数は突き詰めるとその中身は処理の塊だといえます。
ただ、関数の名前はその「処理の要約」なので、
どういう実装で処理が実現されているのかは関数の利用者に隠蔽されています。
たとえばabs()では、「どうやって絶対値を求めるか」を理解していなくても、
それを使えば絶対値が得られることが分かります。
人間の思考能力には限界があるので、ゴチャゴチャとした実装を見せられるよりは、
関数名という要約を見せられたほうが何をやっているか判断しやすくなります。
複雑な処理を隠蔽して機能を分かりやすく提供する、これも関数の利点の1つです。

他にも関数の利用場面は多くあります。
例えばプログラムを書いていると、「同じ処理を何度も使う」という場面が多々あります。
たとえば「2つの数字の絶対値を比較する」というプログラムを作る場合、
関数を使わないと以下のように絶対値を得るコードが2回出現する冗長なものとなります。

```python
x = 5
y = -10

if(x<0):
  x = x * -1
if(y<0):
  y = y * -1

print('abs x > abs y ?')
print(x > y)
# False
```

xとyの絶対値を得る処理はほとんど同じなのにもかかわらず、2回書いています。
2回程度なら書いてもいいような気もしますが、これが5回、10回となればどんどん面倒になっていきます。

先のコードを、関数を使って書き直すと以下のようになります。

```python
x = 5
y = -10

x = abs(x)
y = abs(y)

print('abs x > abs y ?')
print(x > y)
# False
```

冗長な要素が省かれてずいぶんと読みやすくなったのではないでしょうか。
今回はabsのような簡単な関数でしたが、これがたとえば100行以上必要なアルゴリズムだったら、
関数で冗長性を減らすことによる多大な恩恵を得られます。

関数を使わず同じコードを何度もコピペで書いていると、
そのなかに「バグ(プログラムのミス)」があることがわかった場合にすべての場所で修正を施す必要があります。
一方、関数で同じ処理をまとめていると、理想的には一箇所のみの修正となります。
これはプログラムの「保守性(メンテナンス性)」を向上させるというメリットがあります。


## 関数内の関数

Python の関数は実は関数の中に入れ子構造にすることができます。
例えば以下のような使い方ができます。

```python
def test1():
  a = 10

  def test2(x, y):
    return x + y

  return a + test2(5, 6)

print(test1())
# 21
```

上記の例では関数 test1() の中で関数 test2() を定義し、それを使っています。
今回のサンプルのような短い関数であればこのような使い方は不要ですが、
より複雑な処理を関数で行う場合は処理を綺麗に分類するために内部で関数を定義して使うことがあります。
