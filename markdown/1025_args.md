# プログラムへの入力

{{ TOC }}

## 概要

あとで書く

## なぜ入力が必要か

WindowsやMacのGUIアプリケーションを使うときに、さまざまな入力を求められることはありませんか。
書き出すファイル名の入力や、利用するサーバを一覧から選択するといった場合などです。
このようにプログラムがユーザになんらかの入力を求めることは一般的です。
本章では今までのようにテキストベースのプログラムで「ユーザーからプログラムへの入力」を扱う方法についてお話します。

ユーザーからの入力の方法にはいくつかありますが、
ここではプログラムの起動時に指定する「コマンドライン引数」と、
プログラム中でユーザーに入力を求める「標準入力」、
そして標準入力を使ったインタラクティブなプログラムの書き方についてお話します。

コマンドライン引数の使い方についてお話しする前に、それがなぜ必要なのか説明しておきます。
まず以下のような「一人の生徒の成績表を表示するプログラム」のshow_score_sheet.pyがあるとします。

```python
student = 'taro'
score_sheet = get_score_sheet(student)  # get_score_sheetは実装済みとする
print(score_sheet)
```

上記の例では‘taro’の成績を取得しています。
では、‘taro’の代わりに‘jiro’の成績を取得したいと思ったらどのようにすればよいと思いますか。
成績取得をする関数に与える生徒名の‘taro’を‘jiro’にしてやればよいです。

```python
student = 'jiro'  # 生徒の名前を変更
score_sheet = get_score_sheet(student)
print(score_sheet)
```

ただ、40人の生徒の成績を表示したい場合、プログラムのファイルを40回開いて、
その都度生徒の名前を変更してプログラムを動かすのは正直面倒くさいです。
それにそもそも「プログラムを開いてそれを修正する」などということは、そのプログラムの開発者でなければできません。
要するにプログラムファイルをいちいち書き変えるという対応での解決策はなしということです。

## コマンドライン引数

解決方法はいろいろ考えられますが、最も一般的なものは、コマンドライン引数を利用することです。
コマンドライン引数とは、Pythonコマンドでプログラムを起動する際に与えるパラメータのことです。
たとえば以下のようなものになります。

```
python3 show_score_sheet.py taro
```

注目して欲しいのは3番目のキーワードのtaroです。
今まではPythonプログラムを実行するときは“python ファイル名”だけでしたが、そこにtaroが追加されています。
このtaroという与えられたキーワードを、Pythonのプログラムが内部で利用することで、
生徒の名前をプログラム中に直接書き込まなくても指定した生徒の成績を取得できるようになります。
今回は生徒名ですが、プログラムによってはファイル名であったり接続するサーバ名であったり、いろいろな利用方法があります。

コマンドライン引数の使い方は以下の図のようになります。

![image](./0105_image/01.jpg)

直感的に動きをつかんでもらえればよいのですが、起動時に与えたコマンドライン引数を、
プログラム中のsys.argvでアクセスしています。
図の細かい説明をするより、実際にコマンドライン引数を利用するプログラムを見たほうが早そうなので、以下に記載します。

```python
# sysモジュールをimport
import sys

# sys.argvにコマンドライン引数が「リスト」で格納されている
print(sys.argv)
print(len(sys.argv))
```

これを実行すると以下のようになります。

```
% python3 test.py taro
['test.py', 'taro']
2

% python3 test.py taro jiro
['test.py', 'taro', 'jiro']
3
```

sys.argvをprintしているのでわかると思いますが、これは「リスト」です。
そのリストの中の最初の要素は必ずPythonの実行プログラムとなります。
今回は同じディレクトリのプログラムを相対パスで呼び出したのでファイル名だけですが、
絶対パスなどで呼び出すと要素も絶対パスとなります。

2番目以降の要素はコマンドライン引数に与えられた入力値と対応します。
上記例を見てもらうとわかりますが、引数のn番目がsys.argvのn＋1番目の要素になっています。
sys.argvはリストですので、その長さはlen()関数で取得できます。

このコマンドライン引数を先ほどの生徒の成績を取得するプログラムに組むこむのはそれほど難しくありません。

```python
import sys

# 誤った入力値の場合はメッセージとともにプログラム中断
if(len(sys.argv) < 2):
    print('usage: student.py student_name')
    exit()

# sys.argvよりもわかりやすい変数名に代入して使う
student = sys.argv[1]
score_sheet = get_score_sheet(student)
print(score_sheet)
```

コマンドライン引数の長さを調べて、2未満であれば使い方を表示して終了するようにしています。
無言で終了するのも何が原因なのかプログラムの利用者にわからないのでやめたほうがよいです。
コマンドライン引数に指定された内容は、プログラムの途中で都度チェックするよりも、
このように最初に調べてしまって問題があれば終了するとしたほうがきれいにコードを書けるかもしれません。
必要になった場所でチェックをするという実装だと、プログラムのコアとなるロジックに余計なものが食い込み、
汚くわかりにくいコードになりがちなので気をつけてください。

その後はコマンドライン引数の値を「わかりやすい名前の変数」に格納しています。
sys.argvの何番目という表現を延々とプログラム中で使い続けるとわかりにくく、
なおかつ引数の順番を変えたときなどの修正が面倒になるため避けたほうがいいです。
それ以降のコードは先ほどとまったく一緒ですので解説は割愛します。

なお、UnixやLinuxコマンドの「オプション(-v や --help など)」相当のことを実装したいのであれば、
sys.argvを使って根性で作りこむよりも専用のパッケージ「argparse」などを利用したほうがよいかと思います。
