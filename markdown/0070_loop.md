## for によるループ

ループはその名前からわかるように「同じ処理を何度も繰り返す」という処理です。
ループ処理の制御構造にはforとwhileの2つがあり、両者の使うべきポイントは若干異なっています。
そのため、まずは利用頻度の多い for について扱い、その後で while について説明します。

forは「グループにある要素すべてを処理する」といったときに使われるループ構造です。
一番よく使われるのが、前回お話したリスト(配列)に格納されている要素すべてをチェックするような処理です。
JavaやCで使われるfor文と書き方はかなり異なるものの、ほとんど同じような場面で使います。

Pythonのfor文のイメージを以下の図に書きます。

![image](./0040_image/02.jpg)

難しい用語でいうと「イテレーター」と呼ばれる処理方式なのですが、
ようするに「たくさんある集合の先頭ひとつを取り出して、それを処理する。
それが終わったら、次を取り出して処理をする」ということを、集合が空になるまで繰り返すというイメージです。

それほど難しくないので例で示しましょう。
1、2、3、4、5という数字が格納されているリストの中身を、
一つひとつすべてprint出力する処理をforで書くと以下のようになります。

```python
a = [1,2,3,4,5]

for i in a:
  print(i)
```

この for 文は以下のような動きをします。

0. リスト a から 1 を取り出して i に格納。それをprint出力
0. リスト a から 2 を取り出して i に格納。それをprint出力
0. …(中略)…
0. リスト a から 5 を取り出して i に格納。それをprint出力
0. リスト a からすべてを取り出したのでforのコードブロックを終了

すでに想像はついているかもしれませんが、出力は以下のようになります。

```
1
2
3
4
5
```

イテレーターを使っているので、Javaのfor文で使うような「インデックス(配列の何番目か)による制御」に比べて、
間違った要素を指定するリスクが減っています。
一方、インデックスを操作するような複雑な処理は python の for では実現できません。
そのような場合は後述する while を使うことになります。

### forをシーケンスに使う

なお、for 文はリスト以外の「シーケンス型」と呼ばれる「並びを持つ型」 にも使えます。
例えば今までに扱った文字列もシーケンス型なので for 文が使えます。

```
text = 'hello'
for c in text:
  print(c)

# h
# e
# l
# l
# o
```

ただ、for 文は十中八九はリスト及びそれに似た型に対して利用することになると思います。
それ以外の型で使うことはあまり多くありません。

### for の変数名

for 文を書く際に注意すべきなのは取り出した値を格納する変数の名前付けです。
プログラムとしては変数名として有効なものであれば何を書いても動くのですが、
一般的には以下のようなルールがあります。

*	リストなどのシーケンスの変数名に対応する単数形の名前
*	順番に並んだ数字の場合は i, j, k (i が既に使われていれば j といった具合)
*	リストや文字列から取り出す「一文字」は c (character の c)

例えばリストとして students という複数形があればそれを取り出す変数は student といった具合です。
自分でプログラムを開発する場合はこのような名前付けになるように注意を払って下さい。
サンプルプログラムなどで数字の配列に対して for 文を回す場合は i という変数名を使うことも多いですが、
これは index という単語から来ています。
i が既に使われている場合は j, k と使っていくのですが、
これは単に ijk というアルファベットとしての並びがあるからです。
l (小文字のL)は数字の1や大文字のI (i)と見分けが使いにくいので使用は避けることが望ましいとされています。
変数名としてよい名前が浮かばないときに i が使われることも多いのですが、あまりよい使い方ではありません。

## while によるループ

whileもforと同じくループ処理のための制御構造です。
ただ、whileは「ループを何周すればいいかわからない処理」に利用されます。

先ほどのforの例を思い出して下さい。forでのループ回数は「リストaに格納されている要素の数」と明確にわかります。
このような場合はforで処理すべきです。
一方、たとえば「123456789という数字を2進数で表現するのに必要な桁数を求める処理」が必要だとした場合、
これをどうfor文で処理すればいいか、想像できますか。私はシンプルでスマートな実装は思いつかないです。

解き方はいろいろあると思いますが、一番簡単な解法の一つとして、以下のようなものが考えられます。

1.	2 の 1 乗は 123456789 より大きいか　-> No
2.	2 の 2 乗は 123456789 より大きいか　-> No
3.	..
4.	2 の N 乗は 123456789 より大きいか　-> No
5.	2 の N+1 乗は 123456789 より大きいか　-> YES
6.	N+1桁あれば 123456789 を表現可能だとわかる

この処理では2を1乗、2乗とループ処理でどんどん大きくしていきますが、
最終的に2の何乗になるかがわかりません。
このようなときに「特定の条件をクリアするまでループを回す」ためにwhileを使うと便利です。

以下にwhile文の使い方のイメージ図をのせます。

![image](./0040_image/03.jpg)

上記の図を見てもらうとわかるように、while文はループを回るごとに条件式をチェックして、
それがTrueならループを継続して、Falseならループを抜けるという処理をします。
これはJavaやCのwhileとまったく同じです。

先ほどの2進数の桁数を求めるプログラムをwhileで書いてみます。

```python
a = 123456789
i = 1
while(2**i < a):
  i+=1
print(i)
# 27
```

すでに扱った内容ですが、上記のプログラムを補足すると、2**iは「2のi乗」を計算していて、
i+=1はiをインクリメント(i = i + 1)しています。
2**iが123456789より小さい間はiをインクリメントしていき、
2**iが123456789より大きくなったらループを抜けるという動きをします。
ループを抜けた際iに入っている値が必要な桁数を表しています。

## break と continue によるループ制御

ループ制御そのものの打ち切りや「ループのその回だけ」の打ち切りが必要な場面があります。
たとえば以下のような偶数が含まれるかを判定するプログラムがあるとします。

```python
a = [1,3,5,7,9,10,11,13,15]
has_even = False
for i in a:
  if(i%2 == 0):
    has_even = True
print("List has even: " + str(has_even))
# True
```

上記はリストを for 文で走査し、その要素が偶数であれば has_even という変数に True をいれます。
リストに偶数がなければ False のままで、偶数があれば True になります。
今回はリストの中に10があるので、当然Trueとなります。

ただ、よく考えてみてください。なにか無駄な処理があると思いませんか。
そう、ループが10になった回で偶数があることがわかったのに、さらに偶数が含まれるかチェックを繰り返しています。
10が現れた時点で偶数があることはわかりきっているので、ループを回し続けるのは無駄です。

「break」を使ってループ処理を打ち切ることで、この問題を解決できます。
break を使ったプログラムは以下のようになります。

```python
a = [1,3,5,7,9,10,11,13,15]
has_even = False
for i in a:
  print(i)   # NEW CODE
  if(i%2 == 0):
    has_even = True
    break  # NEW CODE
print("List has even: " + str(has_even))
```

確認のためにbreakだけでなく、print文も追加しています。
これを実行すると以下のようになります。

```
1
3
5
7
9
10
List has even: True
```

どうです、11以降のチェックをしなくなりました。
i に10が代入されたタイミングで break が実行され、ループから抜けているためです。

### continue

一方「continue」ですが、正直こちらはbreakほど頻繁に利用されない気がします。
ただ、ループで「特定の条件の場合だけ処理をしたい」というときに利用されることが多いです。

たとえば、数値1から99のリストのうち、3でも5でも割り切れるものだけを画面出力する必要があるとします。
リストを使わないで愚直な書き方をすると以下のようになります(実際はcontinueを使わなくとも、もっとスマートに書けます)。

```python
for i in range(1,100):
  if(i%3 == 0):
    if(i%5 == 0):
      print(i)

# 15 30 45 60 75 90
```

上記は range 関数で [1,2,3,..,98,99] というリストを作成し、
それに対して for ループを回しています。
もし、iが3で割り切れたら、もしiが5で割り切れたら……などというように条件分岐がどんどん深くなってしまいます。
これをcontinueを使って書き直すと、次のようになります。

```python
for i in range(1,100):
  if(i%3 != 0):
    continue
  if(i%5 != 0):
    continue
  print(i)

# 15 30 45 60 75 90
```

行数は増えてしまいましたが、プログラムの見渡しはよくなりましたね。
このように使いようによっては、breakとcontinueは便利です。

### 無限ループ

個人的に私がよく使うのは「whileの条件判定にTrueをいれた無限ループ」をbreakで抜けるというものです。
たとえば以下のような構造です。

```
while(True):
  処理
  if(条件):
    処理
    break
  処理
```

気をつけないと無限ループから抜けられなくなりますが、
適切に使えば while の条件式に判定をいれるよりも綺麗なコードが書けます。
